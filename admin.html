<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administrador - TechStore Cuba</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- Admin Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <a href="admin.html" class="text-2xl font-bold text-blue-600 dark:text-blue-400">TechStore Admin</a>
                    <span class="px-2 py-1 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 rounded-full text-xs font-medium">ADMIN</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="theme-toggle" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600">
                        <span class="dark:hidden">üåô</span>
                        <span class="hidden dark:inline">‚òÄÔ∏è</span>
                    </button>
                    <select id="language-select" class="bg-gray-100 dark:bg-gray-700 border-0 rounded-lg px-3 py-1">
                        <option value="es">üá™üá∏ ES</option>
                        <option value="en">üá∫üá∏ EN</option>
                        <option value="fr">üá´üá∑ FR</option>
                        <option value="pt">üáßüá∑ PT</option>
                    </select>
                    <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors" data-translate="admin.logout">
                        Cerrar Sesi√≥n
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-white dark:bg-gray-800 shadow-sm min-h-screen">
            <nav class="p-4">
                <ul class="space-y-2">
                    <li>
                        <a href="admin.html" class="flex items-center space-x-3 px-3 py-2 rounded-lg bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 font-medium">
                            <span>üìä</span>
                            <span data-translate="admin.dashboard">Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-productos.html" class="flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <span>üì¶</span>
                            <span data-translate="admin.products">Productos</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-pedidos.html" class="flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <span>üõí</span>
                            <span data-translate="admin.orders">Pedidos</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-usuarios.html" class="flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <span>üë•</span>
                            <span data-translate="admin.users">Usuarios</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-configuracion.html" class="flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <span>‚öôÔ∏è</span>
                            <span data-translate="admin.settings">Configuraci√≥n</span>
                        </a>
                    </li>
                    <li class="pt-4 border-t border-gray-200 dark:border-gray-700">
                        <a href="index.html" class="flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <span>üè†</span>
                            <span data-translate="admin.view_store">Ver Tienda</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8">
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white" data-translate="admin.dashboard_title">Dashboard de Administrador</h1>
                <p class="text-gray-600 dark:text-gray-400 mt-2" data-translate="admin.dashboard_subtitle">Resumen general de la tienda</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600 dark:text-gray-400" data-translate="admin.total_products">Total Productos</p>
                            <p id="total-products" class="text-2xl font-bold text-gray-900 dark:text-white">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                            <span class="text-blue-600 dark:text-blue-400 text-xl">üì¶</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600 dark:text-gray-400" data-translate="admin.total_orders">Total Pedidos</p>
                            <p id="total-orders" class="text-2xl font-bold text-gray-900 dark:text-white">0</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center">
                            <span class="text-green-600 dark:text-green-400 text-xl">üõí</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600 dark:text-gray-400" data-translate="admin.total_users">Total Usuarios</p>
                            <p id="total-users" class="text-2xl font-bold text-gray-900 dark:text-white">0</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center">
                            <span class="text-purple-600 dark:text-purple-400 text-xl">üë•</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600 dark:text-gray-400" data-translate="admin.total_revenue">Ingresos Totales</p>
                            <p id="total-revenue" class="text-2xl font-bold text-gray-900 dark:text-white">$0</p>
                        </div>
                        <div class="w-12 h-12 bg-yellow-100 dark:bg-yellow-900 rounded-lg flex items-center justify-center">
                            <span class="text-yellow-600 dark:text-yellow-400 text-xl">üí∞</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Orders -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-900 dark:text-white" data-translate="admin.recent_orders">Pedidos Recientes</h2>
                        <a href="admin-pedidos.html" class="text-blue-600 dark:text-blue-400 hover:underline text-sm" data-translate="admin.view_all">Ver todos</a>
                    </div>
                    <div id="recent-orders" class="space-y-4">
                        <!-- Se cargar√°n din√°micamente -->
                    </div>
                </div>

                <!-- Low Stock Products -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-900 dark:text-white" data-translate="admin.low_stock">Stock Bajo</h2>
                        <a href="admin-productos.html" class="text-blue-600 dark:text-blue-400 hover:underline text-sm" data-translate="admin.manage">Gestionar</a>
                    </div>
                    <div id="low-stock-products" class="space-y-4">
                        <!-- Se cargar√°n din√°micamente -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/translations.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/products.js"></script>
    <script src="js/admin.js"></script>
    <script>
        // Verificar acceso de administrador
        function checkAdminAccess() {
            const currentUser = getCurrentUser();
            if (!currentUser || !currentUser.isAdmin) {
                alert('Acceso denegado. Solo administradores pueden acceder a esta p√°gina.');
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }

        // Cargar estad√≠sticas del dashboard
        function loadDashboardStats() {
            const products = getProducts();
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            
            // Calcular estad√≠sticas
            const totalProducts = products.length;
            const totalOrders = orders.length;
            const totalUsers = users.length;
            const totalRevenue = orders.reduce((sum, order) => sum + (order.total || 0), 0);

            // Actualizar UI
            document.getElementById('total-products').textContent = totalProducts;
            document.getElementById('total-orders').textContent = totalOrders;
            document.getElementById('total-users').textContent = totalUsers;
            document.getElementById('total-revenue').textContent = `$${totalRevenue.toFixed(2)}`;
        }

        // Cargar pedidos recientes
        function loadRecentOrders() {
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const recentOrders = orders.slice(-5).reverse();
            const container = document.getElementById('recent-orders');

            if (recentOrders.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-sm">No hay pedidos recientes</p>';
                return;
            }

            container.innerHTML = '';
            recentOrders.forEach(order => {
                const orderElement = document.createElement('div');
                orderElement.className = 'flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg';
                orderElement.innerHTML = `
                    <div>
                        <p class="font-medium text-gray-900 dark:text-white text-sm">${order.id}</p>
                        <p class="text-xs text-gray-600 dark:text-gray-400">${order.customer?.firstName || 'Cliente'} ${order.customer?.lastName || ''}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-semibold text-gray-900 dark:text-white text-sm">$${order.total?.toFixed(2) || '0.00'}</p>
                        <p class="text-xs text-green-600 dark:text-green-400">${order.status || 'Pendiente'}</p>
                    </div>
                `;
                container.appendChild(orderElement);
            });
        }

        // Cargar productos con stock bajo
        function loadLowStockProducts() {
            const products = getProducts();
            const lowStockProducts = products.filter(product => product.stock < 10);
            const container = document.getElementById('low-stock-products');

            if (lowStockProducts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-sm">Todos los productos tienen stock suficiente</p>';
                return;
            }

            container.innerHTML = '';
            lowStockProducts.slice(0, 5).forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg';
                productElement.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <img src="${product.image}" alt="${product.name}" class="w-10 h-10 object-cover rounded">
                        <div>
                            <p class="font-medium text-gray-900 dark:text-white text-sm">${product.name}</p>
                            <p class="text-xs text-gray-600 dark:text-gray-400">${product.category}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-semibold text-red-600 dark:text-red-400 text-sm">${product.stock} unidades</p>
                    </div>
                `;
                container.appendChild(productElement);
            });
        }

        // Inicializar dashboard
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkAdminAccess()) return;
            
            loadDashboardStats();
            loadRecentOrders();
            loadLowStockProducts();
            updateTranslations();
        });
    </script>
</body>
</html>
